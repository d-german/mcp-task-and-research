@page "/templates"

<MudText Typo="Typo.h5" Class="mb-4">Prompt Templates</MudText>

<MudPaper Elevation="2" Class="pa-4">
    @if (_isLoading)
    {
        <MudProgressLinear Color="Color.Primary" Indeterminate="true" />
    }
    else
    {
        <MudDataGrid T="TemplateInfo" 
                     Items="@_templates"
                     Sortable="true"
                     Filterable="true"
                     QuickFilter="@_quickFilter"
                     Hover="true"
                     Dense="true">
            <ToolBarContent>
                <MudText Typo="Typo.h6">Available Templates</MudText>
                <MudSpacer />
                <MudTextField @bind-Value="_searchString"
                              Placeholder="Search templates..."
                              Adornment="Adornment.Start"
                              AdornmentIcon="@Icons.Material.Filled.Search"
                              IconSize="Size.Medium"
                              Immediate="true"
                              Class="mt-0" />
                <MudIconButton Icon="@Icons.Material.Filled.Refresh"
                               OnClick="LoadTemplatesAsync"
                               Title="Refresh"
                               Class="ml-2" />
            </ToolBarContent>
            <Columns>
                <PropertyColumn Property="x => x.Name" Title="Name" Sortable="true">
                    <CellTemplate>
                        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                            <MudIcon Icon="@Icons.Material.Filled.Description" Size="Size.Small" Color="Color.Primary" />
                            @context.Item.Name
                        </MudStack>
                    </CellTemplate>
                </PropertyColumn>
                <PropertyColumn Property="x => x.Category" Title="Category" Sortable="true">
                    <CellTemplate>
                        <MudChip T="string" Size="Size.Small" Color="Color.Info">@context.Item.Category</MudChip>
                    </CellTemplate>
                </PropertyColumn>
                <PropertyColumn Property="x => x.Preview" Title="Preview">
                    <CellTemplate>
                        <MudText Typo="Typo.body2" Class="text-truncate" Style="max-width: 400px;">
                            @context.Item.Preview
                        </MudText>
                    </CellTemplate>
                </PropertyColumn>
                <TemplateColumn Title="Actions" Sortable="false">
                    <CellTemplate>
                        <MudIconButton Icon="@Icons.Material.Filled.Visibility"
                                       Size="Size.Small"
                                       OnClick="@(() => ViewTemplate(context.Item))"
                                       Title="View" />
                        <MudIconButton Icon="@Icons.Material.Filled.Edit"
                                       Size="Size.Small"
                                       OnClick="@(() => EditTemplate(context.Item))"
                                       Title="Edit" />
                    </CellTemplate>
                </TemplateColumn>
            </Columns>
            <NoRecordsContent>
                <MudText>No templates found.</MudText>
            </NoRecordsContent>
        </MudDataGrid>
    }
</MudPaper>

<MudDialog @bind-Visible="_showDialog" Options="@_dialogOptions">
    <TitleContent>
        <MudText Typo="Typo.h6">
            <MudIcon Icon="@Icons.Material.Filled.Description" Class="mr-2" />
            @(_isEditMode ? "Edit Template" : "View Template"): @_selectedTemplate?.Name
        </MudText>
    </TitleContent>
    <DialogContent>
        <MudTextField @bind-Value="_templateContent"
                      Label="Template Content"
                      Lines="20"
                      Variant="Variant.Outlined"
                      ReadOnly="@(!_isEditMode)"
                      FullWidth="true"
                      Class="template-editor" />
    </DialogContent>
    <DialogActions>
        @if (_isEditMode)
        {
            <MudButton OnClick="CloseDialog">Cancel</MudButton>
            <MudButton Color="Color.Primary"
                       Variant="Variant.Filled"
                       OnClick="SaveTemplate">
                Save
            </MudButton>
        }
        else
        {
            <MudButton OnClick="@(() => { _isEditMode = true; })">Edit</MudButton>
            <MudButton OnClick="CloseDialog">Close</MudButton>
        }
    </DialogActions>
</MudDialog>
