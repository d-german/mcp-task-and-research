import{u as I,r as o,j as e}from"./index-CiGTQkIw.js";function F({task:a,onBack:x,projectRoot:h,profileId:l,onNavigateToTask:b,taskIndex:y,allTasks:g,onSave:j}){const{t:f}=I(),[n,C]=o.useState({description:a.description||"",notes:a.notes||"",implementationGuide:a.implementationGuide||"",verificationCriteria:a.verificationCriteria||"",agent:a.agent||""}),[m,u]=o.useState(!1),[v,p]=o.useState(null),[E,k]=o.useState([]);o.useEffect(()=>{(async()=>{if(l)try{const t=await fetch(`/api/agents/combined/${l}`);if(t.ok){const i=await t.json();k(i)}}catch(t){console.error("Error loading agents:",t)}})()},[l]);const N=s=>s?new Date(s).toLocaleString(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}):"â€”",T=s=>({pending:"#ffa500",in_progress:"#3498db",completed:"#27ae60",blocked:"#e74c3c"})[s]||"#666",w=s=>({CREATE:"âž•",TO_MODIFY:"âœï¸",REFERENCE:"ðŸ“–",DEPENDENCY:"ðŸ”—",OTHER:"ðŸ“„"})[s]||"ðŸ“„",d=(s,t)=>{C(i=>({...i,[s]:t}))},S=async()=>{if(u(!0),p(null),console.log("Saving task with profileId:",l),console.log("Task data:",{taskId:a.id,updates:n}),!l){p("Profile ID is missing. Please try again."),u(!1);return}try{const s=`/api/tasks/${l}/update`;if(console.log("Calling API:",s),!(await fetch(s,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({taskId:a.id,updates:n})})).ok)throw new Error("Failed to update task");j&&j(n)}catch(s){console.error("Error saving task:",s),p("Failed to save task. Please try again.")}finally{u(!1)}};return e.jsxs("div",{className:"task-detail-view edit-mode",children:[e.jsxs("div",{className:"task-detail-header",children:[e.jsxs("h2",{children:[e.jsxs("span",{className:"task-number",children:["TASK ",y+1]}),a.name,e.jsx("span",{className:"edit-badge",children:"EDITING"})]}),e.jsx("button",{className:"back-button",onClick:x,children:"â† Back to Tasks"})]}),e.jsxs("div",{className:"task-detail-content",children:[e.jsxs("div",{className:"task-detail-section",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Status:"}),e.jsx("span",{className:`status-badge status-${a.status}`,style:{backgroundColor:T(a.status)},children:a.status?.replace("_"," ")})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"ID:"}),e.jsx("span",{className:"detail-value monospace",children:a.id})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Created:"}),e.jsx("span",{className:"detail-value",children:N(a.createdAt)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Updated:"}),e.jsx("span",{className:"detail-value",children:N(a.updatedAt)})]})]}),e.jsxs("div",{className:"task-detail-section",children:[e.jsx("h3",{children:f("description")}),e.jsx("textarea",{className:"edit-textarea",value:n.description,onChange:s=>d("description",s.target.value),placeholder:"Enter task description...",rows:4})]}),e.jsxs("div",{className:"task-detail-section",children:[e.jsx("h3",{children:"Notes"}),e.jsx("textarea",{className:"edit-textarea",value:n.notes,onChange:s=>d("notes",s.target.value),placeholder:"Enter notes...",rows:3})]}),e.jsxs("div",{className:"task-detail-section",children:[e.jsx("h3",{children:"Implementation Guide"}),e.jsx("textarea",{className:"edit-textarea",value:n.implementationGuide,onChange:s=>d("implementationGuide",s.target.value),placeholder:"Enter implementation guide...",rows:6})]}),e.jsxs("div",{className:"task-detail-section",children:[e.jsx("h3",{children:"Verification Criteria"}),e.jsx("textarea",{className:"edit-textarea",value:n.verificationCriteria,onChange:s=>d("verificationCriteria",s.target.value),placeholder:"Enter verification criteria...",rows:4})]}),e.jsxs("div",{className:"task-detail-section",children:[e.jsx("h3",{children:"Assigned Agent"}),e.jsxs("select",{className:"agent-select",value:n.agent,onChange:s=>d("agent",s.target.value),children:[e.jsx("option",{value:"",children:"No agent assigned"}),E.map(s=>{const t=s.name.replace(/\.(md|yaml|yml)$/,"");return e.jsxs("option",{value:t,children:[t," ",s.description?`- ${s.description.substring(0,100)}${s.description.length>100?"...":""}`:""]},s.name)})]})]}),a.summary&&e.jsxs("div",{className:"task-detail-section",children:[e.jsx("h3",{children:"Summary"}),e.jsx("div",{className:"detail-content",children:a.summary})]}),a.analysisResult&&e.jsxs("div",{className:"task-detail-section",children:[e.jsx("h3",{children:"Analysis Result"}),e.jsx("div",{className:"detail-content",children:a.analysisResult})]}),a.dependencies&&a.dependencies.length>0&&e.jsxs("div",{className:"task-detail-section",children:[e.jsx("h3",{children:"Dependencies"}),e.jsx("div",{className:"dependencies-list",children:a.dependencies.map((s,t)=>{let i,c;if(typeof s=="string")i=s,c=null;else if(s&&typeof s=="object")i=s.taskId||s.id,c=s.name;else return null;const r=g?g.findIndex($=>$.id===i):-1,A=r>=0?`TASK ${r+1}`:"TASK ?";return e.jsx("span",{className:"task-number dependency-badge",onClick:()=>b(i),title:`${i}${c?` - ${c}`:""}`,children:A},t)})})]}),a.relatedFiles&&a.relatedFiles.length>0&&e.jsxs("div",{className:"task-detail-section",children:[e.jsx("h3",{children:"Related Files"}),e.jsx("div",{className:"related-files-list",children:a.relatedFiles.map((s,t)=>e.jsxs("div",{className:"related-file-item",children:[e.jsx("span",{className:"file-type-icon",children:w(s.type)}),e.jsxs("div",{className:"file-info",children:[e.jsx("div",{className:"file-path monospace file-link",onClick:i=>{const c=h?`${h}/${s.path}`:s.path;navigator.clipboard.writeText(c);const r=i.currentTarget;r.classList.add("copied"),setTimeout(()=>{r.classList.remove("copied")},2e3)},title:h?`Click to copy: ${h}/${s.path}`:`Click to copy: ${s.path}`,children:s.path}),s.description&&e.jsx("div",{className:"file-description",children:s.description}),(s.lineStart||s.lineEnd)&&e.jsxs("div",{className:"file-lines",children:["Lines: ",s.lineStart||"?"," - ",s.lineEnd||"?"]})]})]},t))})]}),e.jsxs("div",{className:"edit-actions",children:[v&&e.jsx("div",{className:"error-message",children:v}),e.jsx("button",{className:"save-button",onClick:S,disabled:m,children:m?"Saving...":"Save Changes"}),e.jsx("button",{className:"cancel-button",onClick:x,disabled:m,children:"Cancel"})]})]})]})}export{F as default};
